---
date: 2025-08-11
title: Deep Research智能体框架
description: 六个专门针对深度研究功能进行架构优化及创新的框架
mermaid: true
mathjax: true
category: [智能体]
tags: [智能体, 深度研究, 大模型]
ogImage: https://astro-yi.obs.cn-east-3.myhuaweicloud.com/avatar.png
---


开源框架对比
![rag-framework-comparison](/pic/DeepResearch/rag-framework-comparison.png)

闭源应用对比
![深度研究闭源应用对比](/pic/DeepResearch/深度研究闭源应用对比.png)

# 基础框架-OpenAI 指南

不要试图用一个巨大的提示词让模型一次性完成所有研究。应该将复杂的研报任务分解成一个清晰、模块化的三步流程：
1. **规划 (Plan)**: 让一个**高级模型**将用户的主问题分解成一系列具体的、可独立研究的子问题。
2. **执行 (Execute)**: 并行地对每个子问题进行研究，调用搜索 API 获取信息，并让模型对单个信息源进行总结。
3. **合成 (Synthesize)**: 将所有子问题的答案汇总起来，交给一个**高级模型**，让它撰写成一篇连贯、完整的最终报告。

## 实践技巧
1. **为正确的任务选择正确的模型**
- 问题澄清和改写: 使用小一些、更快的模型。这两步只是启动研究过程，如果输入的 prompt 足够详细，这两步甚至可以跳过。
- 规划 (Plan) 和 合成 (Synthesize) 阶段: 使用能力最强的模型。这两个步骤需要强大的推理、逻辑组织和长文本生成能力，它们的质量直接决定了最终报告的上限。
- 执行 (Execute) 阶段: 对搜索到的单个网页或文档进行初步总结时，可以使用更便宜、更快的模型。这个任务相对简单（总结一篇具体文章），不需要顶级的推理能力。
2. **并行处理以最大化效率**
- 在“执行”阶段，一旦“规划”步骤生成了所有子问题列表，就应该使用**异步编程**（如 Python 的 asyncio）来并行发起对每个子问题的研究请求。
3. **使用函数调用（Function Calling）或 JSON 模式获取结构化输出**
- 规划阶段: 指示模型使用“函数调用”或“JSON 模式”，输出一个包含所有子问题字符串的 JSON 列表。这样可以直接、准确地解析出需要执行的任务清单。
- 执行阶段: 同样，在总结单个页面时，也可以要求模型以固定的 JSON 格式返回结果，例如 {"summary": "...", "key_points": [...]}。
4. **外部工具的必要性（LLM 不是万能的）**
- 集成一个或多个高质量的搜索 API（如 Google Search API, Brave Search API, Serper 等）来获取实时、广泛的信息。
- 在提示词中明确告知模型它可以使用这些工具，并通过函数调用等方式将工具的输出结果返回给模型。
5. **精心设计提示词（Prompt Engineering）**
- **规划提示词**: 应明确告知模型其角色是一个“世界级的首席研究员”，任务是“将一个复杂问题分解为一组可以独立研究的、详尽的子问题”。
- **执行提示词**: 应指示模型扮演“专家分析师”，任务是“根据提供的原始文本，回答一个具体的问题，并进行简洁总结”。
- **合成提示词**: 这是最终决定报告质量的关键。应包含所有子问题的答案，并给出非常明确的指令，例如：“你是一位顶级行业分析师，请整合以下所有研究资料，撰写一份全面、客观、结构清晰的深度研究报告。报告应包含引言、正文和结论，并保持专业的语调。”

## 实践案例
0. 问题
```
研究索马鲁肽对全球医疗保健系统的经济影响。  
应做的：  
- 包含具体的数字、趋势、统计数据和可衡量的成果。  
- 优先考虑可靠、最新的来源：同行评审的研究、卫生组织（例如世界卫生组织、美国疾病控制与预防中心）、监管机构或制药公司  
的盈利报告。  
- 包含内联引用并返回所有来源元数据。  
  
进行分析，避免泛泛而谈，并确保每个部分都支持  
数据支持的推理，这些推理可以为医疗保健政策或财务模型提供参考。
```

1. 问题澄清
```
您正在与一位请求开展研究任务的用户交谈。您的工作是从用户那里收集更多信息，以成功完成任务。  
  
指导原则：  
- 收集所有必要信息时务必简洁**  
- 确保以简洁、结构良好的方式收集完成研究任务所需的所有信息。  
- 为清晰起见，请根据需要使用项目符号或编号列表。  
- 请勿询问不必要的信息或用户已提供的信息。  
  
重要提示：请勿自行进行任何研究，只需收集将提供给研究人员进行研究任务的信息即可。
```

2. User Prompt 改写
```
用户会给你一个研究任务。你的工作是为研究人员提供一套完成该任务的指导说明。请勿自行完成任务，只需提供完成该任务的说明即可。  
  
指导原则：  
1. **尽量具体和详细**  
- 包含所有已知的用户偏好，并明确列出需要考虑的关键属性或维度。  
- 务必将用户提供的所有详细信息都包含在说明中。  
  
2. **将未说明但必要的维度填写为开放式**  
- 如果某些属性对于有意义的输出至关重要，但用户未提供，请明确说明它们是开放式的或默认为无特定约束。  
  
3. **避免不必要的假设**  
- 如果用户未提供特定细节，请勿自行虚构。  
- 相反，应说明缺乏具体说明，并指导研究人员将其视为灵活变通或接受所有可能的选项。  
  
4. **使用第一人称**  
- 从用户的角度表达请求。  
  
5. **表格**  
- 如果您确定使用表格有助于说明、组织或增强研究成果中的信息，则必须明确要求研究人员提供表格。  
  
示例：  
- 产品比较（消费者）：比较不同智能手机型号时，  
要求提供一个表格，并列列出每种型号的功能、价格和消费者评分。  
- 项目跟踪（工作）：概述项目可交付成果时，创建一个表格，列出任务、截止日期、负责的团队成员和状态更新。  
- 预算规划（消费者）：制定个人或家庭预算时，  
要求提供一个表格，详细说明收入来源、每月支出和储蓄目标。  
- 竞争对手分析（工作）：评估竞争对手产品时，  
要求提供一个表格，其中包含关键指标，例如市场份额、定价和主要差异化因素。  
  
6. **标题和格式**  
- 您应该在提示中包含预期的输出格式。  
- 如果用户要求的内容最好以结构化格式返回（例如报告、计划等），请研究人员将其格式化为报告，并使用适当的标题和格式，以确保清晰度和结构。  
  
7. **语言**  
- 如果用户输入的是英语以外的语言，请告知研究人员使用该语言进行回复，除非用户查询明确要求以其他语言回复。  
  
8. **来源**  
- 如果需要优先考虑特定来源，请在提示中指定。  
- 对于产品和旅行研究，最好直接链接到官方或主要网站（例如，官方品牌网站、制造商页面或亚马逊等信誉良好的电商平台，以获取用户评论），而不是聚合网站或注重搜索引擎优化的博客。  
- 对于学术或科学查询，建议直接链接到原始论文或官方期刊出版物，而不是调查论文或二手摘要。  
- 如果查询使用特定语言，请优先考虑以该语言出版的资料。
```

3. 加入人工审核环节
在规划阶段之后加入一个人工审核步骤。让用户（或您自己）审查和修改模型生成的子问题列表，确保研究方向正确无误后，再启动昂贵的“执行”阶段。这可以有效避免后续步骤的“垃圾进，垃圾出”。

# ByteDance/DeerFlow 框架

**分层多智能体系统**
![DeerFlow框架](/pic/DeepResearch/DeerFlow框架.png)

## 角色定义
- **协调器 (Coordinator)**: 整个工作流的入口和管理者。接收用户的初始请求，启动研究流程，并在需要时将任务委派给规划器。协调器也作为用户和系统之间的主要交互界面。
- **规划器 (Planner)**: 扮演策略师的角色。负责将用户提出的复杂研究问题分解成一系列结构化的、可执行的步骤。规划器会评估当前是否需要收集更多信息，还是可以开始生成报告，管理整个研究的流程。
- **研究团队 (Research Team)**: 这是一组专门执行具体任务的智能体，如同一个“研究小组”。**研究员** 负责执行网络搜索、调用API、抓取网页内容等，以收集所需的信息和数据。 **程序员** 负责执行 Python 代码，用于数据分析、代码片段测试等技术性任务。
- **报告员 (Reporter)**: 研究流程的最后一环。负责将研究团队收集到的所有信息和发现进行汇总、整合和结构化，最终生成多种格式的综合研究报告，例如 Notion 风格的文档、播客甚至是 PowerPoint 演示文稿。

## 技术特点
- **构建于开源项目之上**: 底层用 LangChain 和 LangGraph 等流行的开源项目。用来构建和管理不同智能体之间的状态和通信，使得整个工作流程像一个有向图一样清晰和可追溯。
- **模块化和可扩展性**: 高度模块化，支持“即插即用”的工具集。集成了 Tavily、Brave Search、DuckDuckGo 等多种搜索引擎，以及用于网页抓取的 Jina 等工具，并且可以轻松扩展以支持自定义的 API 或模型。
- **人机协作 (Human-in-the-Loop)**: DeerFlow 并非一个完全自主的“黑箱”系统，而是强调人与 AI 的协作。用户可以审查和修改AI生成的研究计划，在执行过程中调整参数，并在最后对报告进行精炼。这种混合模式在用户测试中被证明可以显著减少研究时间，同时保持内容的高准确性。
- **微服务架构**: 采用微服务架构，包含了研究引擎、Web UI、数据库和存储等多个组件，使其更具可扩展性。

# HuggingFace/SmolAgents

**SmolAgents的OpenDeepResearch模块 更轻量级、注重代码和简洁性的架构**
*smol是small的俏皮用法，故smolagents的含义是“轻量的agent工具”
![SmolAgents框架](/pic/DeepResearch/SmolAgents框架.png)

## 角色定义
- **CodeAgent**: 最主要的智能体类型，通过生成和执行 Python 代码来完成任务，并且可以调用预先定义好的工具。
- **ToolCallingAgent**: smolagents 仍然支持传统的、通过生成 JSON/文本 来调用工具的智能体，以兼容更广泛的用例和模型。
- **MultiStepAgent**: 这种智能体能够将一个复杂的任务分解成多个步骤，并周期性地生成或更新计划，以结构化、目标导向的方式逐步解决问题。

## 技术特点
- **以代码为中心**的智能体 ，动作直接表现为 Python 代码片段。LLM 会生成一小段 Python 代码来执行下一步操作，而不是生成需要解析的JSON对象。
- 优势: 
	- 表现力强: 编程语言天生就适合用来表达复杂的动作和逻辑。 
	- 组合性好: 代码可以轻松地进行嵌套、抽象和重用（例如定义函数），这是JSON难以做到的。 
	- 安全性: 为了安全地执行这些由AI生成的代码，smolagents 支持在沙盒环境（如 E2B）中运行。

# LangChainAI/OpenDeepResearch

一个多阶段、迭代和自反思的智能体工作流，旨在模拟人类进行深度研究的过程

## 核心理念
Plan-Search-Reflect-Write (规划-搜索-反思-撰写) 
1. 规划 (Plan): 工作流的起点。一个“规划器”智能体会接收用户提出的研究主题，并将其分解成多个子问题或子主题。这个规划结果不仅指导后续的研究步骤，也构成了最终报告的大纲。
2. 搜索 (Search): 根据规划阶段生成的子问题，系统会生成具体的搜索查询，并调用各种搜索工具（如 Tavily, Perplexity, ArXiv 等）来收集相关信息。这个过程可以是并行的，多个研究循环可以同时针对不同的子主题进行。
3. 反思 (Self-Reflect): 这是该架构的**关键**所在。在收集到初步信息后，一个智能体会评估当前的信息是否足够，是否存在知识空白。如果发现信息不足或有新的问题出现，系统会生成新的、更精确的搜索查询，进入下一轮迭代。这种“自我反思”的循环会持续进行，直到信息足够全面。
4. 撰写 (Write): 当所有的研究循环完成后，一个“撰写者”智能体会将所有收集到的、经过验证和提炼的信息进行整合，并根据最初的规划大纲，生成一份结构完整、引用充分的综合性研究报告。

## 实现方式
### 图状工作流 (Graph-based Workflow)
![DeerFlow框架](/pic/DeepResearch/LangChain-Graph框架.png)

主要使用 LangGraph 库来构建。将研究的每一步（规划、搜索、反思等）都建模为图中的一个节点（Node），使得整个流程非常清晰、可追溯。特别强调人机协作（Human-in-the-Loop），允许用户在关键节点（如规划完成后）进行审查和提供反馈，然后再继续执行。这种实现方式控制力强，适合对报告质量和准确性要求极高的场景。

### Multi-agent 迭代循环 (Iterative Loop)
![DeerFlow框架](/pic/DeepResearch/LangChain-Loop框架.png)

核心是递归的研究循环，在每一次循环中，智能体都会评估已有信息，生成新的问题，并进一步搜索，直到达到预设的深度（depth）和广度（breadth）。  
- 简单模式 (Simple): 跳过初始的规划步骤，直接进入一个单一的、迭代的研究循环。这种模式速度更快，适用于较窄或较具体的研究问题。
- 深度模式 (Deep): 包含初始的规划步骤，并为每个子主题部署并行的、独立的迭代研究器。这种模式更深入、更全面，适合复杂和宽泛的研究主题。